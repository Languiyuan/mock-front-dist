import{b as E,c as F}from"./user-D8PzdqVx.js";import{f as G}from"./index-Ck4Kn7K7.js";import{g as q,b as H,c as J}from"./project-D5p_IelN.js";import{d as N,r as c,B as K,b as n,c as h,n as D,w as s,g as m,f as t,h as u,s as A,t as O,o as Q,a as R,e as I,D as W,F as j,G as X,x as B,i as Y,y as Z}from"./index-BsoPr0S2.js";import"./login-D-CZcHGF.js";const ee={class:"h-96 w-full flex flex-col"},ae={class:"h-10 flex items-center"},te={class:"w-full h-[calc(100%_-_40px)] pt-2"},le=N({__name:"MembersManage",emits:["success"],setup($,{expose:x,emit:g}){const v=g,r=c(0),p=c(""),f=c(!1),z=(e,a)=>{r.value=e,p.value=a,y(),f.value=!0,l.value=null,i.value=""},d=c(!1),o=c([]),y=async()=>{d.value=!0;try{const{data:e}=await q({projectId:r.value});o.value=e.filter(a=>a.isCreateUser===0)}finally{d.value=!1}},i=c(""),l=c(),M=(e,a)=>{if(!e)return a([]);S(e).then(_=>{if(_.length){const b=_.filter(k=>k.username!==p.value);a(b)}else a([])})},S=async e=>{const{data:a}=await E({username:e});return a},V=e=>{l.value=e};K(()=>i.value,()=>{l.value&&i.value!==l.value.username&&(l.value=null),l.value});const C=async()=>{if(!l.value)return A.error("请先选择成员");const e={projectId:r.value,memberId:l.value.id},{data:a}=await H(e);v("success"),await y(),A.success(a)},U=async e=>{O.confirm("请确认是否删除","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{const a={memberId:e.userId,projectId:e.projectId},{data:_}=await J(a);v("success"),await y(),A.success(_)}).catch(()=>{})};return x({open:z}),(e,a)=>{const _=n("el-autocomplete"),b=n("el-button"),k=n("el-table-column"),T=n("el-empty"),L=n("el-table"),P=n("el-dialog");return h(),D(P,{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=w=>f.value=w),title:"项目成员管理",width:"600"},{default:s(()=>[m("div",ee,[m("div",ae,[t(_,{class:"w-2/6",modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=w=>i.value=w),"value-key":"username","fetch-suggestions":M,placeholder:"输入名称搜索",clearable:"",onSelect:V},null,8,["modelValue"]),t(b,{class:"ml-4",type:"primary",onClick:C},{default:s(()=>[u("确认添加")]),_:1})]),m("div",te,[t(L,{height:"100%",data:o.value,"header-row-class-name":"members-header-row-class-name"},{empty:s(()=>[t(T,{"image-size":50,description:"暂无数据"})]),default:s(()=>[t(k,{prop:"username",label:"姓名"}),t(k,{prop:"operate",label:"操作"},{default:s(w=>[t(b,{link:"",type:"primary",size:"small",onClick:ue=>U(w.row)},{default:s(()=>[u(" 移除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])])]),_:1},8,["modelValue"])}}}),se={class:"bg-white h-full pt-4"},oe={class:"w-full h-12 pl-4 pr-4 flex items-center justify-between"},ne={class:"h-full flex items-center"},re={class:"h-full flex items-center"},ce={class:"h-[calc(100%_-_48px_-_48px)] pl-4 pr-4"},ie={class:"w-full h-12 flex items-center justify-end pr-4"},ge=N({__name:"index",setup($){Q(()=>{p()});const x=c([]),g=c(!1),v=c(""),r=R({total:0,pageNo:1,pageSize:20}),p=async()=>{const d={name:v.value,pageNo:r.pageNo,pageSize:r.pageSize};g.value=!0;try{const{data:o}=await F(d);x.value=o.list,r.total=o.total,g.value=!1}catch{g.value=!1}},f=c(),z=d=>{f.value&&f.value.open(d.id,d.createUsername)};return(d,o)=>{const y=n("el-input"),i=n("el-button"),l=n("el-table-column"),M=n("el-tag"),S=n("el-empty"),V=n("el-table"),C=n("el-pagination"),U=X("loading");return h(),I(j,null,[m("div",se,[m("div",oe,[m("div",ne,[t(y,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=e=>v.value=e),style:{width:"240px"},class:"pr-4",placeholder:"名称",clearable:""},null,8,["modelValue"]),t(i,{type:"primary",icon:"Search",onClick:p},{default:s(()=>[u("查询")]),_:1})]),m("div",re,[t(i,{type:"primary",icon:"Plus"},{default:s(()=>[u("添加")]),_:1})])]),m("div",ce,[W((h(),D(V,{data:x.value,height:"100%",style:{width:"100%"},border:!0,"header-row-class-name":"user-header-row-class-name"},{empty:s(()=>[t(S,{description:"暂无数据"})]),default:s(()=>[t(l,{type:"index",label:"序号",width:"80"}),t(l,{prop:"name",label:"名称"}),t(l,{prop:"createUsername",label:"创建人"},{default:s(e=>[u(B(e.row.createUsername||"-"),1)]),_:1}),t(l,{prop:"description",label:"项目描述"}),t(l,{prop:"createTime",label:"创建时间",sortable:"",width:"200"},{default:s(e=>[u(B(Y(G)(e.row.createTime)),1)]),_:1}),t(l,{prop:"members",label:"项目成员"},{default:s(e=>{var a;return[e.row.members&&((a=e.row.members)!=null&&a.length)?(h(!0),I(j,{key:0},Z(e.row.members,(_,b)=>(h(),D(M,{key:"member"+b,type:"primary",class:"mr-1",effect:"light",size:"large"},{default:s(()=>[u(B(_.username),1)]),_:2},1024))),128)):(h(),I(j,{key:1},[u("-")],64))]}),_:1}),t(l,{label:"操作",width:"200"},{default:s(e=>[t(i,{link:"",type:"primary",size:"small",disabled:e.row.isAdmin,onClick:a=>z(e.row)},{default:s(()=>[u(" 添加成员 ")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[U,g.value]])]),m("div",ie,[t(C,{"current-page":r.pageNo,"onUpdate:currentPage":o[1]||(o[1]=e=>r.pageNo=e),"page-size":r.pageSize,"onUpdate:pageSize":o[2]||(o[2]=e=>r.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:r.total,onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])])]),t(le,{ref_key:"membersManageDialog",ref:f,onSuccess:p},null,512)],64)}}});export{ge as default};
